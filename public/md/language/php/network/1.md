# 1. Context Options

- PHP는 모든 파일 시스템 및 스트림 래퍼에 사용 가능한 컨텍스트 옵션 제공
- `HTTP` 요청시 `method`, `header` 등 설정 가능

## 1-1 컨텍스트, 옵션, 파라미터 생성 방법

- 스트림 컨텍스트 생성

```
stream_context_create(?array $options = null, ?array $params = null): resource`
```

- 옵션 생성

```
stream_context_set_option(
        resource $stream_or_context,
        string $wrapper,
        string $option,
        mixed $value
): bool

stream_context_set_option(resource $stream_or_context, array $options): bool
```

- 매개변수

```
stream_context_set_params(resource $context, array $params): bool
```

## 1-2 Socket 컨텍스트 옵션

| 옵션           | 설명                                                                                                                                                                                                                                                                                                                                                             |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `bindto`       | PHP가 네트워크에 액세스할 때 사용할 IP 주소(IPv4 또는 IPv6) 및/또는 포트 번호를 지정하는 데 사용됩니다. 구문은 IPv4 주소의 경우 `ip:port`, IPv6 주소의 경우 `[ip]:port`입니다. IP 또는 포트를 0으로 설정하면 시스템이 IP 및/또는 포트를 선택하도록 합니다. FTP는 정상 작동 중에 두 개의 소켓 연결을 생성하므로이 옵션을 사용하여 포트 번호를 지정할 수 없습니다. |
| `backlog`      | 소켓의 대기열에 대기 중인 연결 수를 제한하는 데 사용됩니다.                                                                                                                                                                                                                                                                                                      |
| `ipv6_v6only`  | IPv4를 IPv6로 매핑하는 데 대한 OS 기본값을 재정의합니다. 특히 [::]에 바인딩이 있을 때 IPv4 주소를 별도로 수신하려는 경우 중요합니다.                                                                                                                                                                                                                             |
| `so_reuseport` | 하나의 ip:port 쌍에 여러 바인딩을 허용하도록하며 이는 별도의 프로세스에서도 가능합니다.                                                                                                                                                                                                                                                                          |
| `so_broadcast` | 브로드캐스트 주소로부터 데이터를 보내고 받도록 허용합니다.                                                                                                                                                                                                                                                                                                       |
| `tcp_nodelay`  | 이 옵션을 true로 설정하면 SOL_TCP, NO_DELAY = 1을 적절하게 설정하여 TCP Nagle 알고리즘을 비활성화합니다.                                                                                                                                                                                                                                                         |

## 1-3 HTTP 컨텍스트 옵션

| 옵션               | 설명                                                                                                                                                                                                                                                 |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `method`           | GET, POST 또는 원격 서버에서 지원하는 다른 HTTP 메서드. 기본값은 GET.                                                                                                                                                                                |
| `header`           | 요청 중에 전송 할 추가 헤더. 이 옵션의 값은 Location: 리디렉션을 따를 때 포함하여 다른 값 (예 : User-agent :, Host :, Authentication :)을 무시합니다. 따라서 follow_location이 활성화되어 있지 않으면 Host : 헤더를 설정하는 것이 권장되지 않습니다. |
| `user_agent`       | User-Agent : 헤더와 함께 보낼 값. 이 값은 header 옵션에서 지정되지 않은 경우에만 사용됩니다. 기본적으로 user_agent php.ini 설정이 사용됩니다.                                                                                                        |
| `content`          | 헤더 이후에 전송 될 추가 데이터. 일반적으로 POST 또는 PUT 요청과 함께 사용됩니다.                                                                                                                                                                    |
| `proxy`            | 프록시 서버 주소를 지정하는 URI. (예 : tcp://proxy.example.com:5100).                                                                                                                                                                                |
| `request_fulluri`  | true로 설정되면 요청을 구성 할 때 전체 URI가 사용됩니다. (예 : GET http://www.example.com/path/to/file.html HTTP/1.0). 이것은 비표준 요청 형식이지만 일부 프록시 서버에서 필요할 수 있습니다. 기본값은 false.                                        |
| `follow_location`  | Location 헤더 리디렉션을 따를지 여부. 비활성화하려면 0으로 설정. 기본값은 1.                                                                                                                                                                         |
| `max_redirects`    | 따를 리디렉션의 최대 횟수. 값이 1 이하이면 리디렉션이 따르지 않음을 의미. 기본값은 20.                                                                                                                                                               |
| `protocol_version` | HTTP 프로토콜 버전. PHP 8.0.0 이후로는 기본값이 1.1이며, 해당 버전 이전에는 기본값이 1.0입니다.                                                                                                                                                      |
| `timeout`          | 초 단위로 지정된 읽기 제한 시간 (예 : 10.5). 기본적으로 default_socket_timeout php.ini 설정이 사용됩니다.                                                                                                                                            |
| `ignore_errors`    | 실패 상태 코드에서도 내용을 가져올지 여부. 기본값은 false.                                                                                                                                                                                           |

## 1-4 FTP 컨텍스트 옵션

| 옵션         | 설명                                                                                                                   |
| ------------ | ---------------------------------------------------------------------------------------------------------------------- |
| `overwrite`  | 원격 서버의 이미 존재하는 파일을 덮어쓸지 허용하는 여부. 쓰기 모드 (업로드)에만 적용됨. 기본값은 false.                |
| `resume_pos` | 전송을 시작할 파일 오프셋. 읽기 모드 (다운로드)에만 적용됨. 기본값은 0 (파일의 시작).                                  |
| `proxy`      | http 프록시 서버를 통해 FTP 요청을 프록시하는 것을 허용. 파일 읽기 작업에만 적용됨. 예 : tcp://squid.example.com:8000. |

## 1-5 SSL 컨텍스트 옵션

| 옵션                      | 설명                                                                                                                                                                                                                                                                                    |
| ------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `peer_name`               | 사용할 피어 이름. 이 값이 설정되지 않으면 스트림을 열 때 사용한 호스트 이름을 기반으로 추측됨.                                                                                                                                                                                          |
| `verify_peer`             | 사용된 SSL 인증서의 검증을 요구. 기본값은 true.                                                                                                                                                                                                                                         |
| `verify_peer_name`        | 피어 이름의 검증을 요구. 기본값은 true.                                                                                                                                                                                                                                                 |
| `allow_self_signed`       | 자체 서명된 인증서를 허용. verify_peer가 필요. 기본값은 false.                                                                                                                                                                                                                          |
| `cafile`                  | 로컬 파일 시스템의 CA 파일의 위치. 피어 검증 옵션(verify_peer)과 함께 사용하여 원격 피어의 신원을 인증.                                                                                                                                                                                 |
| `capath`                  | cafile이 지정되지 않았거나 해당 위치에서 인증서를 찾을 수 없는 경우 검색할 해시된 인증서 디렉터리.                                                                                                                                                                                      |
| `local_cert`              | 파일 시스템의 로컬 인증서 파일 경로. PEM으로 인코딩된 파일이어야 하며, 인증서 및 개인 키를 포함할 수 있음.                                                                                                                                                                              |
| `local_pk`                | 개별 파일 (local_cert) 및 개인 키를 위한 파일 시스템의 로컬 개인 키 파일 경로.                                                                                                                                                                                                          |
| `passphrase`              | 로컬 인증서 파일이 인코딩된 경우 사용된 암호.                                                                                                                                                                                                                                           |
| `verify_depth`            | 인증서 체인이 너무 깊을 경우 중단. 기본값은 검증 없음.                                                                                                                                                                                                                                  |
| `ciphers`                 | 사용 가능한 암호 목록 설정. 기본값은 DEFAULT.                                                                                                                                                                                                                                           |
| `capture_peer_cert`       | true로 설정하면 피어 인증서 컨텍스트 옵션이 만들어져 피어 인증서를 포함합니다.                                                                                                                                                                                                          |
| `capture_peer_cert_chain` | true로 설정하면 피어 인증서 체인 컨텍스트 옵션이 만들어져 인증서 체인을 포함합니다.                                                                                                                                                                                                     |
| `SNI_enabled`             | true로 설정하면 서버 이름 표시 (SNI)가 활성화됩니다. SNI를 활성화하면 동일한 IP 주소에서 여러 인증서를 사용할 수 있습니다.                                                                                                                                                              |
| `disable_compression`     | 설정되면 TLS 압축을 비활성화합니다. CRIME 공격 벡터를 완화하는 데 도움이 될 수 있습니다.                                                                                                                                                                                                |
| `peer_fingerprint`        | 원격 인증서 다이제스트가 지정한 해시와 일치하지 않으면 중단됩니다. 문자열 또는 배열 사용 가능. 문자열을 사용하면 길이에 따라 "md5" (32) 또는 "sha1" (40) 중 어떤 해싱 알고리즘을 적용할지가 결정됩니다. 배열을 사용하면 각 키는 해싱 알고리즘 이름이며 해당 값은 예상 다이제스트입니다. |
| `security_level`          | 보안 수준 설정. 지정되지 않으면 라이브러리 기본 보안 수준을 사용합니다.                                                                                                                                                                                                                 |

## 1-6 Phar 컨텍스트 옵션

| 속성     | 설명                   |
| -------- | ---------------------- |
| compress | Phar 압축 상수 중 하나 |
| metadata | Phar 메타데이터        |

## 1-7 Zip 컨텍스트 옵션

| 속성     | 설명     |
| -------- | -------- |
| password | 비밀번호 |

---
